<html>
  <head>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta
      http-equiv="content-type"
      content="text/html; charset=utf-8"
      lang="en"
    />
    <meta content="EMC Terra Nova map replacemen" property="og:title" />
    <meta
      content="EarthMC Terra Nova map replacement"
      property="og:description"
    />
    

    <link rel="stylesheet" href="css/main.css" />
    <script src="js/leaflet.js"></script>

    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
      integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
      crossorigin=""
    />

    <script
      type="text/javascript"
      src="https://code.jquery.com/jquery-latest.js"
    ></script>
    <title>EMC Terra Nova map replacement</title>
  </head>
  <body>
    <div id="map">
     
    </div>
    <script>
    
      var emcmap = L.map("map", {
        crs: L.CRS.Simple,
      }).setView([0, 0], -3);


    const geoJsonFeatures = []
async function FetchMap(){
  const response = await fetch("./assets/markers_earth.json")
if(response.status !== 200){ 
  return console.log("Error: status code" + response.status)
  
}
const data = await response.json()
console.log(data)
  const areas = data.sets['townyPlugin.markerset'].areas

  for (const areaID in areas){
    const area = areas[areaID]
    const coords = area.x.map((x, index) => [x, -area.z[index]-64]) 

    const feature = {
        "type": "Feature",
       "properties": {"color": area.color, "fillColor":area.fillcolor},
        "geometry": {
          "type": "Polygon",
          "coordinates": [coords]
          },
      }
      geoJsonFeatures.push(feature)
  }
}
FetchMap().then(( ) => {
  console.log(geoJsonFeatures)

var FeatureCollection =   { "type": "FeatureCollection", "features": geoJsonFeatures }
  console.log(FeatureCollection)
L.geoJson(FeatureCollection, { style: function(feature){
  return {color: feature.properties.color, fillColor:feature.properties.color, opacity:0.65, weight:1}
}}).addTo(emcmap)
      
})


      


      // EMC background tiles
      L.tileLayer(
        "https://earthmc.net/map/nova/standalone/MySQL_tiles.php?tile=earth/flat/0_0/zzzzz_{x1}_{y1}.png",
        {
          maxZoom: -4,
          minZoom: -4,
          tileSize: 128,
        }
      ).addTo(emcmap);
      L.tileLayer(
        "https://earthmc.net/map/nova/standalone/MySQL_tiles.php?tile=earth/flat/0_0/zzzz_{x2}_{y2}.png",
        {
          maxZoom: -3,
          minZoom: -3,
          tileSize: 128,
        }
      ).addTo(emcmap);
      L.tileLayer(
        "https://earthmc.net/map/nova/standalone/MySQL_tiles.php?tile=earth/flat/0_0/zzz_{x3}_{y3}.png",
        {
          maxZoom: -2,
          minZoom: -2,
          tileSize: 128,
        }
      ).addTo(emcmap);
      L.tileLayer(
        "https://earthmc.net/map/nova/standalone/MySQL_tiles.php?tile=earth/flat/0_0/zz_{x4}_{y4}.png",
        {
          maxZoom: -1,
          minZoom: -1,
          tileSize: 128,
        }
      ).addTo(emcmap);
      L.tileLayer(
        "https://earthmc.net/map/nova/standalone/MySQL_tiles.php?tile=earth/flat/0_0/z_{x5}_{y5}.png",
        {
          maxZoom: 0,
          minZoom: 0,
          tileSize: 128,
        }
      ).addTo(emcmap);
      L.tileLayer("https://earthmc.net/map/nova/standalone/MySQL_tiles.php?tile=earth/flat/0_0/{x}_{y6}.png", {
        maxZoom: 2,
        maxNativeZoom: 1,
        minZoom: 1,
        tileSize: 128,
      }).addTo(emcmap);
    </script>
    <script type="text/javascript" src="js/main.js"></script>
  </body>
</html>
